{"createdAt":"2023-06-28T11:34:04.230Z","updatedAt":"2023-06-28T11:42:04.000Z","id":"3","name":"ProposalNotifier","active":true,"nodes":[{"parameters":{"mode":"combine","mergeByFields":{"values":[{"field1":"protocol","field2":"dao"}]},"options":{}},"id":"b0ee1e1c-0db8-442e-a12f-8a4bcefa8f80","name":"Merge","type":"n8n-nodes-base.merge","typeVersion":2.1,"position":[2320,280]},{"parameters":{"rule":{"interval":[{"field":"minutes","minutesInterval":10}]}},"id":"75b77ef8-d9ca-4762-9772-1390e522340d","name":"10min Trigger","type":"n8n-nodes-base.scheduleTrigger","typeVersion":1,"position":[880,460]},{"parameters":{"operation":"subtractFromDate","magnitude":"={{ $json.timestamp }}","timeUnit":"minutes","duration":10,"outputFieldName":"LastTime"},"id":"d5d6dd0e-239f-409f-91eb-49fa8f187651","name":"Last execution date","type":"n8n-nodes-base.dateTime","typeVersion":2,"position":[980,260]},{"parameters":{"operation":"formatDate","date":"={{ $json.LastTime }}","format":"X","outputFieldName":"ExecTimestamp","options":{}},"id":"74c15469-3866-423d-8ff0-089ad738960e","name":"Last time to timestamp","type":"n8n-nodes-base.dateTime","typeVersion":2,"position":[1160,260]},{"parameters":{"url":"https://api.boardroom.info/v1/proposals?indexedAt=desc&limit=100","authentication":"genericCredentialType","genericAuthType":"httpQueryAuth","options":{}},"id":"1a57867a-4545-4cbd-92e2-41b11e4a6d60","name":"Get Boardroom Data","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1360,260],"credentials":{"httpQueryAuth":{"id":"1","name":"Boardroom"}}},{"parameters":{"fieldToSplitOut":"data","options":{}},"id":"774626f6-b711-4276-b64c-61481d7303d5","name":"Parse API data","type":"n8n-nodes-base.itemLists","typeVersion":2.1,"position":[1520,260]},{"parameters":{"conditions":{"number":[{"value1":"={{ $json.startTime.timestamp }}","operation":"largerEqual","value2":"={{ $('Last time to timestamp').item.json.ExecTimestamp }}"}],"string":[{"value1":"={{ $json.currentState }}","value2":"active"}]}},"id":"31767291-9fd0-483e-ac86-14f5d5415f18","name":"Filter old proposals","type":"n8n-nodes-base.filter","typeVersion":1,"position":[1660,260]},{"parameters":{"conditions":{"string":[{"value1":"={{ $json.protocol }}","value2":"makerdao"},{"value1":"={{ $json.protocol }}","value2":"optimism"},{"value1":"={{ $json.protocol }}","value2":"bitdao"},{"value1":"={{ $json.protocol }}","value2":"decentraland"},{"value1":"={{ $json.protocol }}","value2":"sushiswap"},{"value1":"={{ $json.protocol }}","value2":"uniswap"},{"value1":"={{ $json.protocol }}","value2":"badgerdao.eth"},{"value1":"={{ $json.protocol }}","value2":"stargatefi"},{"value1":"={{ $json.protocol }}","value2":"ens"},{"value1":"={{ $json.protocol }}","value2":"safedao"},{"value1":"={{ $json.protocol }}","value2":"olympusdao"},{"value1":"={{ $json.protocol }}","value2":"curvefi"},{"value1":"={{ $json.protocol }}","value2":"stakedaoeth"},{"value1":"={{ $json.protocol }}","value2":"aave"}]},"combineConditions":"OR"},"id":"8f3a6351-ef5b-463f-aadf-2c034fd2ff2e","name":"Filter DAOs","type":"n8n-nodes-base.filter","typeVersion":1,"position":[1800,260]},{"parameters":{"method":"POST","url":"https://api.textcortex.com/v1/texts/summarizations","authentication":"genericCredentialType","genericAuthType":"httpHeaderAuth","sendBody":true,"bodyParameters":{"parameters":[{"name":"max_tokens","value":512},{"name":"mode","value":"default"},{"name":"model","value":"sophos-1"},{"name":"n","value":1},{"name":"source_lang","value":"en"},{"name":"target_lang","value":"en"},{"name":"temperature","value":0.7},{"name":"text","value":"={{ $json.content}}"}]},"options":{"redirect":{"redirect":{}},"proxy":""}},"id":"c4c7d1f9-663c-4a3a-b06d-0f60f09bac92","name":"AI summary","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1940,260],"credentials":{"httpHeaderAuth":{"id":"2","name":"Header Auth account"}}},{"parameters":{"keepOnlySet":true,"values":{"string":[{"name":"title","value":"={{ $('Filter DAOs').item.json.title }}"},{"name":"protocol","value":"={{ $('Filter DAOs').item.json.protocol }}"},{"name":"adapter","value":"={{ $('Filter DAOs').item.json.adapter }}"},{"name":"url","value":"={{ $('Filter DAOs').item.json.externalUrl }}"},{"name":"summary","value":"={{ $('AI summary').item.json.data.outputs[0].text }}"},{"name":"boardroomUrl","value":"=https://boardroom.io/{{ $('Filter DAOs').item.json.protocol }}/proposal/{{ $('Filter DAOs').item.json.refId }}"}],"number":[{"name":"endTimeReadable","value":"={{ DateTime.fromSeconds($('Filter DAOs').item.json.endTime.timestamp).toFormat('HH:mm dd/MM/yyyy')}}"},{"name":"endTimestamp","value":"={{ $('Filter DAOs').item.json.endTime.timestamp }}"}]},"options":{}},"id":"bc8a9fd7-7869-4fa6-ab0e-beda07b6bd7e","name":"Clean data","type":"n8n-nodes-base.set","typeVersion":2,"position":[2080,260]},{"parameters":{"chatId":"={{ $json.channel }}","text":"=<b>Title</b>\n{{ $json[\"title\"] }}\n\n<b>Vote ends</b>\n{{$json.endTimeReadable}} (GMT)\n<a href=\"https://www.google.com/calendar/render?action=TEMPLATE&text=Vote%20for%20{{ $json.protocol }}%20proposal&dates={{ DateTime.fromSeconds($json.endTimestamp).minus(2,'hours').format('yyyyMMdd')}}T{{ DateTime.fromSeconds($json.endTimestamp).minus(2,'hours').format('HHmmss')}}Z%2F{{ DateTime.fromSeconds($json.endTimestamp).minus(105,'minutes').format('yyyyMMdd')}}T{{ DateTime.fromSeconds($json.endTimestamp).minus(105,'minutes').format('HHmmss')}}Z&details={{$json.summary}}&location={{encodeURIComponent($json.externalUrl) }}\">Add to Google</a> \n\n<b>Vote</b>\n<a href=\"{{ $json.boardroomUrl }}\">Vote on Boardroom</a>\n<a href=\"{{ $json[\"url\"] }}\">Vote on {{ $json.adapter }}</a>\n\n<b>AI summary</b>\n{{ $json[\"summary\"] }} \n\n<i>Summary is made with AI tools, details may be missing, for complete understanding please read full proposal</i>","additionalFields":{"disable_web_page_preview":true,"parse_mode":"HTML"}},"id":"2c7131d3-8a19-4981-aa1b-9ee7a57da98a","name":"Send messages to Channels","type":"n8n-nodes-base.telegram","typeVersion":1,"position":[2480,280],"credentials":{"telegramApi":{"id":"3","name":"Telegram account"}}},{"parameters":{"content":"## How to\nHead to Github repository : https://github.com/JeanGuillemont/KeyMarker-ProposalNotifier for further informations about deployment","height":137.87654320987656,"width":238.15637860082347},"id":"4bd6f3a3-40e0-4765-bfc3-c8020b1b5e6d","name":"Sticky Note","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[680,200]},{"parameters":{"jsCode":"const data =  [\n\n    {\n      dao: \"decentraland\",\n      channel : -1001987443998,\n    },\n    {\n      dao : \"optimism\",\n      channel : -1001945510040,\n    },\n    {\n      dao : \"aave\",\n      channel : -1001905204051,\n    },\n    {\n      dao : \"badgerdao.eth\",\n      channel : -1001866106999,\n    },\n    {\n      dao : \"bitdao\",\n      channel : -1001872460105,\n    },\n    {\n      dao : \"curve\",\n      channel : -1001822065973,\n    },\n    {\n      dao : \"ens\",\n      channel : -1001982992388,\n    },\n    {\n      dao : \"makerdao\",\n      channel : -1001955720497,\n    },\n    {\n      dao : \"olympusdao\",\n      channel : -1001982591292,\n    },\n    {\n      dao : \"safe\",\n      channel : -1001685958962,\n    },\n    {\n      dao : \"stakedaoeth\",\n      channel : -1001742812871,\n    },\n    {\n      dao : \"stargatefi\",\n      channel : -1001830133829,\n    },\n    {\n      dao : \"sushiswap\",\n      channel : -1001800181560,\n    },\n    {\n      dao : \"uniswap\",\n      channel : -1001981919221,\n    }\n];\nreturn data.map(e => {\n  return {\n    json: e\n  }\n});"},"id":"23b81875-355d-4a1e-8bdb-74443b8fc4b1","name":"Create Channels Database","type":"n8n-nodes-base.code","typeVersion":1,"position":[2080,460]}],"connections":{"Merge":{"main":[[{"node":"Send messages to Channels","type":"main","index":0}]]},"10min Trigger":{"main":[[{"node":"Last execution date","type":"main","index":0},{"node":"Create Channels Database","type":"main","index":0}]]},"Last execution date":{"main":[[{"node":"Last time to timestamp","type":"main","index":0}]]},"Last time to timestamp":{"main":[[{"node":"Get Boardroom Data","type":"main","index":0}]]},"Get Boardroom Data":{"main":[[{"node":"Parse API data","type":"main","index":0}]]},"Parse API data":{"main":[[{"node":"Filter old proposals","type":"main","index":0}]]},"Filter old proposals":{"main":[[{"node":"Filter DAOs","type":"main","index":0}]]},"Filter DAOs":{"main":[[{"node":"AI summary","type":"main","index":0}]]},"AI summary":{"main":[[{"node":"Clean data","type":"main","index":0}]]},"Clean data":{"main":[[{"node":"Merge","type":"main","index":0}]]},"Create Channels Database":{"main":[[{"node":"Merge","type":"main","index":1}]]}},"settings":{"timezone":"Etc/GMT","saveManualExecutions":false,"callerPolicy":"workflowsFromSameOwner"},"staticData":{"node:10min Trigger":{"recurrencyRules":[]}},"pinData":{},"versionId":"15f87ae4-3151-43d9-a670-1cfde10f1523","triggerCount":1,"tags":[{"createdAt":"2023-06-28T11:31:08.273Z","updatedAt":"2023-06-28T11:31:08.273Z","id":"1","name":"KeyMaker"}]}