{"createdAt":"2023-08-24T12:53:25.676Z","updatedAt":"2023-09-13T07:52:29.553Z","id":"SDgQzy2vI5aBZznX","name":"ProposalNotifier","active":true,"nodes":[{"parameters":{"mode":"combine","mergeByFields":{"values":[{"field1":"protocol","field2":"dao"}]},"options":{}},"id":"de16886b-9158-44d4-94ba-3ad7647fc3b7","name":"Merge","type":"n8n-nodes-base.merge","typeVersion":2.1,"position":[1200,660]},{"parameters":{"rule":{"interval":[{"field":"minutes","minutesInterval":10}]}},"id":"661d4cf1-badd-4137-ab47-519398761e42","name":"10min Trigger","type":"n8n-nodes-base.scheduleTrigger","typeVersion":1,"position":[-480,840]},{"parameters":{"url":"https://api.boardroom.info/v1/proposals?orderByIndexedAt=desc&limit=200","authentication":"genericCredentialType","genericAuthType":"httpQueryAuth","options":{}},"id":"f573c37c-96be-43cb-8ee6-2dfc66a41237","name":"Get Boardroom Data","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[0,640],"credentials":{"httpQueryAuth":{"id":"I9qDx6lX8LsfGp9j","name":"Boardroom"}}},{"parameters":{"fieldToSplitOut":"data","options":{}},"id":"5dc153ad-d5ed-413e-8130-9206ed91753f","name":"Parse API data","type":"n8n-nodes-base.itemLists","typeVersion":2.1,"position":[160,640]},{"parameters":{"conditions":{"number":[{"value1":"={{ DateTime.fromMillis($json.indexedAt).toSeconds() > $json.startTimestamp ? DateTime.fromMillis($json.indexedAt).toSeconds() : $json.startTimestamp  }}","operation":"largerEqual","value2":"={{ $('Last time to timestamp').item.json.ExecTimestamp }}"}],"string":[{"value1":"={{ $json.currentState }}","value2":"active"}]}},"id":"bf1c918d-35dc-40a0-a30f-ea5b14e40e96","name":"Filter old proposals","type":"n8n-nodes-base.filter","typeVersion":1,"position":[340,640]},{"parameters":{"conditions":{"string":[{"value1":"={{ $json.protocol }}","value2":"makerdao"},{"value1":"={{ $json.protocol }}","value2":"optimism"},{"value1":"={{ $json.protocol }}","value2":"bitdao"},{"value1":"={{ $json.protocol }}","value2":"decentraland"},{"value1":"={{ $json.protocol }}","value2":"sushi"},{"value1":"={{ $json.protocol }}","value2":"uniswap"},{"value1":"={{ $json.protocol }}","value2":"badgerdao"},{"value1":"={{ $json.protocol }}","value2":"stargatefi"},{"value1":"={{ $json.protocol }}","value2":"ens"},{"value1":"={{ $json.protocol }}","value2":"safedao"},{"value1":"={{ $json.protocol }}","value2":"olympusdao"},{"value1":"={{ $json.protocol }}","value2":"curvefi"},{"value1":"={{ $json.protocol }}","value2":"stakedaoeth"},{"value1":"={{ $json.protocol }}","value2":"aave"},{"value1":"={{ $json.protocol }}","value2":"arbitrum"},{"value1":"={{ $json.protocol }}","value2":"gitcoin"},{"value1":"={{ $json.protocol }}","value2":"aavegotchi"},{"value1":"={{ $json.protocol }}","value2":"compound"},{"value1":"={{ $json.protocol }}","value2":"balancer"},{"value1":"={{ $json.protocol }}","value2":"juicebox"},{"value1":"={{ $json.protocol }}","value2":"paraswapdaoeth"},{"value1":"={{ $json.protocol }}","value2":"qidaoeth"},{"value1":"={{ $json.protocol }}","value2":"decryptmediaeth"},{"value1":"={{ $json.protocol }}","value2":"banklessvault"}]},"combineConditions":"OR"},"id":"b2f773ab-144d-48a6-9282-fc37c65afa3c","name":"Filter DAOs","type":"n8n-nodes-base.filter","typeVersion":1,"position":[480,640]},{"parameters":{"keepOnlySet":true,"values":{"string":[{"name":"title","value":"={{ $('Filter DAOs').item.json.title.replace(/<\\/?>/g, 'x').replace(/ \\<|\\>/g, '') }}"},{"name":"protocol","value":"={{ $('Filter DAOs').item.json.protocol }}"},{"name":"adapter","value":"={{ $('Filter DAOs').item.json.adapter }}"},{"name":"url","value":"={{ $('Filter DAOs').item.json.externalUrl }}"},{"name":"summary","value":"={{ $('AIsummarySecondaryOption').item.json.result.replace(/<\\/?>/g, 'x').replace(/</g, '').replace(/ \\<|\\>/g, '') }}"},{"name":"boardroomUrl","value":"=https://boardroom.io/{{ $('Filter DAOs').item.json.protocol }}/proposal/{{ $('Filter DAOs').item.json.refId }}"}],"number":[{"name":"endTimeReadable","value":"={{ DateTime.fromSeconds($('Filter DAOs').item.json[\"endTimestamp\"].toInt()).toFormat('HH:mm dd/MM/yyyy').replace(/\\n/g, ' ')}}\n"},{"name":"endTimestamp","value":"={{ $('Filter DAOs').item.json.endTimestamp }}"}]},"options":{}},"id":"1c9d590b-36b4-44dc-8af9-5621d2ac3d01","name":"Clean data","type":"n8n-nodes-base.set","typeVersion":2,"position":[1000,640]},{"parameters":{"chatId":"={{ $json.channel }}","text":"=<b>Title</b>\n{{ $json[\"title\"] }}\n\n<b>Vote ends</b>\n(GMT){{$json.endTimeReadable.replace(/\\n/g, ' ')}} \n<a href=\"https://www.google.com/calendar/render?action=TEMPLATE&text={{ $json.name }}%20Vote:%20{{encodeURIComponent($json.title) }}%20&dates={{ DateTime.fromSeconds($json.endTimestamp).minus(2,'hours').format('yyyyMMdd')}}T{{ DateTime.fromSeconds($json.endTimestamp).minus(2,'hours').format('HHmmss')}}Z%2F{{ DateTime.fromSeconds($json.endTimestamp).minus(105,'minutes').format('yyyyMMdd')}}T{{ DateTime.fromSeconds($json.endTimestamp).minus(105,'minutes').format('HHmmss')}}Z&details={{encodeURIComponent($json.summary)}}&location={{encodeURIComponent($json.url) }}\">Add to Google</a> \n\n<b>Vote</b>\n<a href=\"{{ $json.boardroomUrl }}\">Vote on Boardroom</a>\n<a href=\"{{ $json[\"url\"] === undefined ? $json[\"govurl\"] : $json[\"url\"] }}\"> or Vote on {{ $json.adapter }} interface</a>\n\n<b>AI summary</b>\n{{ $json[\"summary\"] }} \n\n<i>Summary is made with AI tools, details may be missing, for complete understanding please read full proposal</i>","additionalFields":{"disable_web_page_preview":true,"parse_mode":"HTML"}},"id":"da8692c6-9b49-4c99-aec0-38b8d5f9f73b","name":"Send messages to Channels","type":"n8n-nodes-base.telegram","typeVersion":1,"position":[1360,660],"credentials":{"telegramApi":{"id":"81nawMsDwnUgmU0P","name":"Telegram account"}}},{"parameters":{"content":"## How to\nHead to Github repository : https://github.com/JeanGuillemont/KeyMarker-ProposalNotifier for further informations about deployment","height":137.87654320987656,"width":238.15637860082347},"id":"64843963-978b-4700-83e9-a3421ed82e4d","name":"Sticky Note","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-680,580]},{"parameters":{"jsCode":"const data =  [\n\n    {\n      dao: \"decentraland\",\n      channel : -1001987443998,\n      name:\"Decentraland\",\n      govurl: \"\",\n    },\n    {\n      dao : \"optimism\",\n      channel : -1001945510040,\n      name:\"Optimism\",\n      govurl: \"https://vote.optimism.io/\",\n    },\n    {\n      dao : \"aave\",\n      channel : -1001905204051,\n      name:\"Aave\",\n      govurl: \"https://app.aave.com/governance/\",\n    },\n    {\n      dao : \"badgerdao\",\n      channel : -1001866106999,\n      name:\"Badger\",\n      govurl: \"\",\n    },\n    {\n      dao : \"bitdao\",\n      channel : -1001872460105,\n      name:\"BitDAO\",\n      govurl: \"\",\n    },\n    {\n      dao : \"curvefi\",\n      channel : -1001822065973,\n      name:\"Curve\",\n      govurl: \"\",\n    },\n    {\n      dao : \"ens\",\n      channel : -1001982992388,\n      name:\"ENS\",\n      govurl: \"\",\n    },\n    {\n      dao : \"makerdao\",\n      channel : -1001955720497,\n      name:\"MakerDAO\",\n      govurl: \"https://vote.makerdao.com/\",\n    },\n    {\n      dao : \"olympusdao\",\n      channel : -1001982591292,\n      name:\"Olympus DAO\",\n      govurl: \"\",\n    },\n    {\n      dao : \"safedao\",\n      channel : -1001685958962,\n      name:\"safe DAO\",\n      govurl: \"\",\n    },\n    {\n      dao : \"stakedaoeth\",\n      channel : -1001742812871,\n      name:\"Stake DAO\",\n    },\n    {\n      dao : \"stargatefi\",\n      channel : -1001830133829,\n      name:\"Stargate\",\n      govurl: \"\",\n    },\n    {\n      dao : \"sushi\",\n      channel : -1001800181560,\n      name:\"Sushiswap\",\n      govurl: \"\",\n    },\n    {\n      dao : \"arbitrum\",\n      channel : -1001939136563,\n      name:\"Arbitrum\",\n      govurl: \"\",\n    },\n    {\n      dao : \"gitcoin\",\n      channel : -1001826504378,\n      name:\"Gitcoin\",\n      govurl: \"\",\n    },\n    {\n      dao : \"aavegotchi\",\n      channel : -1001943248093,\n      name:\"Aavegotchi\",\n      govurl: \"\",\n    },\n    {\n      dao : \"compound\",\n      channel : -1001908038125,\n      name:\"Compound\",\n      govurl: \"https://compound.finance/governance\",\n    },\n    {\n      dao : \"balancer\",\n      channel : -1001775549813,\n      name:\"Balancer\",\n      govurl: \"\",\n    },\n    {\n      dao : \"juicebox\",\n      channel : -1001738595789,\n      name:\"JuiceBox\",\n      govurl: \"\",\n    },\n    {\n      dao : \"paraswapdaoeth\",\n      channel : -1001810352905,\n      name:\"Paraswap\",\n      govurl: \"\",\n    },\n    {\n      dao : \"qidaoeth\",\n      channel : -1001910910731,\n      name:\"Qi DAO\",\n      govurl: \"\",\n    },\n    {\n      dao : \"decryptmediaeth\",\n      channel : -1001919910564,\n      name:\"Decrypt\",\n      govurl: \"\",\n    },\n    {\n      dao : \"banklessvault\",\n      channel : -1001924225624,\n      name:\"Bankless\",\n      govurl: \"\",\n    },\n    {\n      dao : \"uniswap\",\n      channel : -1001981919221,\n      name:\"Uniswap\",\n      govurl: \"https://app.uniswap.org/#/vote\",\n    }\n];\nreturn data.map(e => {\n  return {\n    json: e\n  }\n});"},"id":"a6533c8a-1d36-455f-a659-6220283b43cd","name":"Create Channels Database","type":"n8n-nodes-base.code","typeVersion":1,"position":[1000,840]},{"parameters":{"operation":"formatDate","date":"={{ $json.startedAt }}","format":"X","outputFieldName":"ExecTimestamp","options":{}},"id":"4dc002c3-0d3d-4173-aef6-baf2bad16fe9","name":"Last time to timestamp","type":"n8n-nodes-base.dateTime","typeVersion":2,"position":[-160,640]},{"parameters":{"resource":"execution","limit":1,"filters":{"workflowId":{"__rl":true,"value":"SDgQzy2vI5aBZznX","mode":"list","cachedResultName":"ProposalNotifier (#SDgQzy2vI5aBZznX)"},"status":"success"},"options":{"activeWorkflows":false}},"id":"fda773c3-06ab-4644-96e3-0dcbcc970bf0","name":"n8n","type":"n8n-nodes-base.n8n","typeVersion":1,"position":[-300,640],"credentials":{"n8nApi":{"id":"c6mKCrGp2BMB19gl","name":"n8n account"}}},{"parameters":{"method":"POST","url":"https://portal.ayfie.com/api/summarize","authentication":"genericCredentialType","genericAuthType":"httpHeaderAuth","sendBody":true,"bodyParameters":{"parameters":[{"name":"language","value":"auto"},{"name":"text","value":"={{ $json.subcontent }}"},{"name":"min_length","value":"100"},{"name":"max_length","value":"400"}]},"options":{}},"id":"b9cc0e05-31e0-4953-acec-865e76750a50","name":"AIsummarySecondaryOption","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[820,640],"credentials":{"httpHeaderAuth":{"id":"gqfaZ03z1kcPoACu","name":"Ayfie"}}},{"parameters":{"values":{"string":[{"name":"subcontent","value":"={{ $json.content.substring(49,7000).removeMarkdown().replace(/:[a-zA-Z_]+:/g, '') }}"}]},"options":{}},"id":"fe82ec30-b722-450a-919e-47528c08d5f2","name":"SetScondaryOption","type":"n8n-nodes-base.set","typeVersion":2,"position":[640,640]}],"connections":{"Merge":{"main":[[{"node":"Send messages to Channels","type":"main","index":0}]]},"10min Trigger":{"main":[[{"node":"Create Channels Database","type":"main","index":0},{"node":"n8n","type":"main","index":0}]]},"Get Boardroom Data":{"main":[[{"node":"Parse API data","type":"main","index":0}]]},"Parse API data":{"main":[[{"node":"Filter old proposals","type":"main","index":0}]]},"Filter old proposals":{"main":[[{"node":"Filter DAOs","type":"main","index":0}]]},"Filter DAOs":{"main":[[{"node":"SetScondaryOption","type":"main","index":0}]]},"Clean data":{"main":[[{"node":"Merge","type":"main","index":0}]]},"Create Channels Database":{"main":[[{"node":"Merge","type":"main","index":1}]]},"Last time to timestamp":{"main":[[{"node":"Get Boardroom Data","type":"main","index":0}]]},"n8n":{"main":[[{"node":"Last time to timestamp","type":"main","index":0}]]},"SetScondaryOption":{"main":[[{"node":"AIsummarySecondaryOption","type":"main","index":0}]]},"AIsummarySecondaryOption":{"main":[[{"node":"Clean data","type":"main","index":0}]]}},"settings":{"executionOrder":"v1","timezone":"Etc/GMT","saveManualExecutions":true,"callerPolicy":"workflowsFromSameOwner"},"staticData":{"node:10min Trigger":{"recurrencyRules":[]}},"pinData":{},"versionId":"b3e93c9f-14e5-4bc3-8f66-e3322d689fec","triggerCount":1,"tags":[{"createdAt":"2023-08-24T12:52:49.277Z","updatedAt":"2023-08-24T12:52:49.277Z","id":"gOrXoPH3uNS5ZAld","name":"KeyMaker"}]}